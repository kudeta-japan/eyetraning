<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cheese Wonderland â€” Fullscreen Roulette</title>
<style>
  html, body {
    margin:0; padding:0; height:100%; width:100%;
    background:#000; overflow:hidden;
    font-family: ui-sans-serif, sans-serif;
    color:#fff;
  }
  #stage {position:fixed; inset:0;}
  #ui {
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    display:flex; gap:20px; z-index:20;
  }
  button {
    padding:14px 24px; font-size:18px; font-weight:bold;
    border:none; border-radius:12px;
    cursor:pointer; background:linear-gradient(180deg,#ffe08a,#f7b733); color:#111;
    box-shadow:0 4px 14px rgba(0,0,0,.5);
  }
  #result {
    position:fixed; inset:0;
    display:none; justify-content:center; align-items:center;
    background:rgba(0,0,0,.9); z-index:30;
  }
  #result img {
    max-width:80%; max-height:80%; border-radius:16px;
    box-shadow:0 18px 60px rgba(0,0,0,.7);
  }
</style>
</head>
<body>
<div id="stage"></div>

<div id="ui">
  <button id="spin">å›ã™ ğŸ¡</button>
  <button id="reset">ãƒªã‚»ãƒƒãƒˆ ğŸ”„</button>
</div>

<div id="result"><img id="resultImg" src=""></div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
/* ====== åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ====== */
const stage = document.getElementById("stage");
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
stage.appendChild(renderer.domElement);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
camera.position.set(0,4,7);
scene.add(camera);

scene.add(new THREE.AmbientLight(0xffffff,.6));
const spot = new THREE.SpotLight(0xfff2cc,1.5,25,Math.PI/5,.5,1);
spot.position.set(3,6,3);
spot.target.position.set(0,0,0);
scene.add(spot, spot.target);

/* ====== ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆç›¤ ====== */
const wheelGroup = new THREE.Group(); scene.add(wheelGroup);
const texLoader = new THREE.TextureLoader();
const wheelTex = texLoader.load("roulette_ui_6_sections.png");
const disc = new THREE.Mesh(
  new THREE.CircleGeometry(3,256),
  new THREE.MeshStandardMaterial({map:wheelTex, metalness:.1, roughness:.6})
);
disc.rotation.x = -0.35;
wheelGroup.add(disc);

const rim = new THREE.Mesh(
  new THREE.TorusGeometry(3.05,0.12,32,128),
  new THREE.MeshStandardMaterial({color:0xd1a94a, metalness:.8, roughness:.4})
);
rim.rotation.x = -0.35;
wheelGroup.add(rim);

/* ====== çŠ¶æ…‹ç®¡ç† ====== */
let spinning=false, currentAngle=0;

/* ====== å›ã™ ====== */
function spin(){
  if(spinning) return;
  spinning=true;
  const idx = Math.floor(Math.random()*6); // 6ç­‰åˆ†
  const ARC=360/6;
  const center = idx*ARC+ARC/2;
  const deltaDeg=-(6*360+(center-90));
  const start=currentAngle;
  const end=currentAngle+THREE.MathUtils.degToRad(deltaDeg);
  const dur=5000;
  const t0=performance.now();

  function easeOutCubic(t){ return 1-Math.pow(1-t,3); }
  function anim(now){
    const t=Math.min(1,(now-t0)/dur);
    const ang=start+(end-start)*easeOutCubic(t);
    wheelGroup.rotation.z=ang;
    if(t<1){requestAnimationFrame(anim);}
    else{ currentAngle=end; spinning=false; showResult(); }
    renderer.render(scene,camera);
  }
  requestAnimationFrame(anim);
}

/* ====== çµæœè¡¨ç¤º ====== */
const clownFaces=[
  "face.png","suprised.png","happy.png","laugh.png","funny.png"
];
function showResult(){
  const pick=clownFaces[Math.floor(Math.random()*clownFaces.length)];
  document.getElementById("resultImg").src=pick;
  document.getElementById("result").style.display="flex";
}

/* ====== ãƒªã‚»ãƒƒãƒˆ ====== */
document.getElementById("reset").onclick=()=>{
  document.getElementById("result").style.display="none";
  currentAngle=0; wheelGroup.rotation.z=0;
};

/* ====== UIé…ç·š ====== */
document.getElementById("spin").onclick=spin;

/* ====== ãƒªã‚µã‚¤ã‚º ====== */
window.addEventListener("resize",()=>{
  renderer.setSize(window.innerWidth,window.innerHeight);
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
});
renderer.setAnimationLoop(()=>{renderer.render(scene,camera);});
</script>
</body>
</html>
