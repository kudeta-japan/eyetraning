<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Cheese Wonderland | 6-Slice Roulette</title>
<style>
  :root{
    --bg:#0e0f1a; --panel:#15182b; --ink:#f6f7ff; --muted:#a9b1d6;
    --brand:#ffd54d; --accent:#ff6d6d;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1000px 700px at 70% -10%, rgba(255,255,255,.06), transparent 60%), var(--bg); color:var(--ink); font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,"Noto Sans JP",Arial}
  header{position:sticky;top:0;z-index:10;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg, rgba(255,255,255,.04), transparent)}
  .tag{background:var(--brand); color:#111; padding:4px 8px; border-radius:999px; font-weight:900; font-size:12px; margin-right:8px}
  h1{display:inline; font-size:clamp(18px,3.2vw,28px); margin:0}
  main{display:grid; grid-template-columns:1.2fr .8fr; gap:16px; padding:16px}
  @media (max-width:980px){ main{grid-template-columns:1fr} }
  .panel{background:radial-gradient(700px 300px at 100% 0, rgba(255,255,255,.05), transparent 40%), var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; position:relative; overflow:hidden}
  .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:8px 0 12px}
  .group{display:flex; gap:8px; align-items:center; background:#0c1030; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:8px 10px}
  label{font-size:12px; color:var(--muted)}
  input[type="number"]{background:#0a0e24;color:var(--ink);border:1px solid rgba(255,255,255,.14);border-radius:10px;padding:8px 10px;font-size:14px;width:90px;text-align:center}
  button{appearance:none;border:none;border-radius:12px;background:linear-gradient(180deg,#ffe08a,#f7b733);color:#151515;font-weight:900;letter-spacing:.02em;padding:10px 14px;cursor:pointer;box-shadow:0 8px 24px rgba(255,208,90,.25), inset 0 1px 0 rgba(255,255,255,.5)}
  button.ghost{background:#222848;color:var(--ink);border:1px solid rgba(255,255,255,.12);box-shadow:none}
  .mini{font-size:12px; color:var(--muted)}
  .stage{display:grid; grid-template-columns:minmax(280px,640px) 1fr; gap:18px; align-items:center}
  @media (max-width:980px){ .stage{grid-template-columns:1fr} }
  .wheel-wrap{position:relative; aspect-ratio:1/1; width:100%; display:grid; place-items:center; isolation:isolate}
  .pointer{position:absolute; top:-4px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:28px solid var(--accent); filter:drop-shadow(0 6px 12px rgba(255,109,109,.55)); z-index:5}
  .wheel{position:relative; width:92%; aspect-ratio:1/1; border-radius:50%; transform:rotate(0deg); transition:transform 5.2s cubic-bezier(.15,.9,.05,1)}
  .wheel img{width:100%; height:auto; display:block; border-radius:50%}
  .spot{position:absolute; inset:0; background:radial-gradient(180px 140px at 50% 6%, rgba(255,255,255,.18), rgba(255,255,255,0) 60%); mix-blend-mode:screen; pointer-events:none; z-index:3}
  .orders table{width:100%; border-collapse:collapse}
  th,td{padding:8px; border-bottom:1px solid rgba(255,255,255,.08); font-size:14px}
  .badge{font-size:11px; color:#111; background:var(--brand); padding:2px 6px; border-radius:999px; font-weight:800}
  .toast{position:fixed; left:50%; top:14px; transform:translateX(-50%) translateY(-16px); background:#111533; color:var(--ink); border:1px solid rgba(255,255,255,.14); padding:10px 14px; border-radius:14px; font-weight:800; opacity:0; transition:.25s; z-index:100}
  .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>
<header>
  <span class="tag">Cheese Wonderland</span><h1>6-Slice Roulette</h1>
</header>

<main>
  <section class="panel">
    <div class="controls">
      <div class="group">
        <label>‰∫∫Êï∞</label>
        <input type="number" id="people" min="1" step="1" value="2" />
        <button id="apply">Ë®≠ÂÆö</button>
        <span class="mini">ÊÆã„Çä <b id="spinsLeft">--</b> Âõû</span>
      </div>
      <div class="group">
        <button id="spin">Âõû„Åô</button>
        <button id="undo" class="ghost">‰∏ÄÊâãÊàª„Åô</button>
        <button id="reset" class="ghost">„É™„Çª„ÉÉ„Éà</button>
        <span class="mini">F„ÅßÂÖ®ÁîªÈù¢</span>
      </div>
      <div class="group">
        <button id="exportCSV" class="ghost">CSVÊõ∏„ÅçÂá∫„Åó</button>
      </div>
    </div>

    <div class="stage">
      <div class="wheel-wrap">
        <div class="pointer"></div>
        <div class="wheel" id="wheel">
          <!-- ÁîªÂÉè„ÅØÂêå„Åò„Éï„Ç©„É´„ÉÄ or assets/ „Å´ÁΩÆ„Åè -->
          <img id="wheelImg" src="roulette_ui_6_sections.png" alt="Roulette">
        </div>
        <div class="spot"></div>
      </div>

      <div>
        <h3 style="margin:0 0 8px;">Á¢∫ÁéáÔºàÈáç„ÅøÔºâ</h3>
        <div id="weights"></div>
      </div>
    </div>
  </section>

  <section class="panel orders">
    <h3>Ê≥®Êñá„É™„Çπ„Éà</h3>
    <table>
      <thead><tr><th style="text-align:left;">„É°„Éã„É•„Éº</th><th>Á¢∫Áéá</th><th style="text-align:right;">Êï∞Èáè</th></tr></thead>
      <tbody id="orderBody"></tbody>
    </table>
  </section>
</main>

<div class="toast" id="toast">Ë®≠ÂÆö„Åó„Åæ„Åó„Åü</div>

<script>
/*
  6Êû†„ÅÆ‰∏¶„Å≥„ÅØ„ÄåÁîªÂÉèÁîüÊàêÊôÇ„ÅÆÈÖçÁΩÆ„Äç„Å´Âêà„Çè„Åõ„Å¶„ÅÑ„Åæ„ÅôÔºàÊôÇË®àÂõû„ÇäÔºâ:
  0: „Åà„Å≥„Éï„É™„ÉÉ„Çø„Éº, 1: „É≠„Éº„Çπ„Éà„Éù„Éº„ÇØ, 2: „Éï„É©„Ç§„Éâ„ÉÅ„Ç≠„É≥,
  3: „Éê„Ç≤„ÉÉ„Éà,       4: ÈáéËèúÁõõ„Çä,       5: Áâõ„Ç≥„É≠„Ç´„ÉÑ
  ‚Äª ÁîªÂÉè„ÅØ0Â∫¶=Âè≥ÊñπÂêëÂü∫Ê∫ñ„ÅßÈÖçÁΩÆ„Åó„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅ„Éù„Ç§„É≥„Çø(‰∏ä)„Å®„ÅÆ„Ç™„Éï„Çª„ÉÉ„Éà„ÇíË£úÊ≠£„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
*/
const ITEMS = [
  { name:"„Åà„Å≥„Éï„É™„ÉÉ„Çø„Éº", emoji:"üç§", weight:12 }, // 0
  { name:"„É≠„Éº„Çπ„Éà„Éù„Éº„ÇØ", emoji:"üçñ", weight:12 }, // 1
  { name:"„Éï„É©„Ç§„Éâ„ÉÅ„Ç≠„É≥", emoji:"üçó", weight:13 }, // 2
  { name:"„Éê„Ç≤„ÉÉ„Éà",       emoji:"ü•ñ", weight:15 }, // 3
  { name:"ÈáéËèúÁõõ„Çä",       emoji:"ü•¶", weight:13 }, // 4
  { name:"Áâõ„Ç≥„É≠„Ç´„ÉÑ",     emoji:"ü•©", weight:13 }, // 5
];
const N = ITEMS.length;               // 6
const ARC = 360 / N;                  // 60¬∞
let spinsLeft = 0, spinning = false, history = [], rotation = 0;

const wheel = document.getElementById("wheel");
const img   = document.getElementById("wheelImg");
const weightsEl = document.getElementById("weights");
const toast = document.getElementById("toast");

function showToast(msg){ toast.textContent=msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"), 1400); }
function totalWeight(){ return ITEMS.reduce((s,i)=>s+Number(i.weight||0),0); }
function pct(w){ const t=totalWeight(); return t? (w/t*100) : 0; }

function buildWeights(){
  weightsEl.innerHTML = "";
  const t = totalWeight();
  ITEMS.forEach((it, idx)=>{
    const row = document.createElement("div");
    row.style.display="grid"; row.style.gridTemplateColumns="1fr auto"; row.style.gap="8px";
    row.style.alignItems="center"; row.style.padding="8px"; row.style.border="1px solid rgba(255,255,255,.08)";
    row.style.borderRadius="12px"; row.style.background="#0b1030"; row.style.marginBottom="8px";
    const left = document.createElement("div");
    left.innerHTML = `<span class="badge">Êû†</span> ${it.emoji} ${it.name}Ôºà‚âà ${(pct(it.weight)).toFixed(1)}%Ôºâ`;
    const right = document.createElement("div"); right.style.display="flex"; right.style.gap="8px"; right.style.alignItems="center";
    const rng = document.createElement("input"); rng.type="range"; rng.min=0; rng.max=40; rng.value=it.weight; rng.addEventListener("input",()=>{ num.value=rng.value; it.weight=Number(rng.value); refreshOrders(); buildWeights(); });
    const num = document.createElement("input"); num.type="number"; num.min=0; num.max=200; num.value=it.weight; num.style.width="70px"; num.addEventListener("input",()=>{ rng.value=num.value; it.weight=Number(num.value||0); refreshOrders(); });
    right.appendChild(rng); right.appendChild(num);
    row.appendChild(left); row.appendChild(right);
    weightsEl.appendChild(row);
  });
}

function weightedPick(){
  const t = totalWeight() || 1;
  let r = Math.random() * t;
  for(let i=0;i<N;i++){ r -= Number(ITEMS[i].weight||0); if(r<=0) return i; }
  return N-1;
}

function spin(){
  if(spinning || spinsLeft<=0) return;
  spinning = true; document.getElementById("spin").disabled = true;

  const idx = weightedPick();
  // ÁîªÂÉè„ÅØ 0deg=Âè≥Âü∫Ê∫ñ„Å´ÂØæ„Åó„Å¶ slice center = idx*ARC + ARC/2„ÄÇ
  // „Éù„Ç§„É≥„Çø„ÅØÁîªÈù¢‰∏äÈÉ®(=Âè≥„Åã„Çâ90deg)„Å™„ÅÆ„Åß„ÄÅ‰∏≠ÂøÉ„Çí‰∏ä(90deg)„Å´Âêà„Çè„Åõ„ÇãË£úÊ≠£ -90deg„ÄÇ
  const center = idx*ARC + ARC/2;              // ‰æã: idx=0 => 30degÔºàÂè≥=0Âü∫Ê∫ñÔºâ
  const offset = center - 90;                   // ‰∏ä(90deg)„Å∏Âêà„Çè„Åõ„ÇãË£úÊ≠£
  const turns = 6 + Math.floor(Math.random()*2);
  const jitter = (Math.random()*ARC*0.2) - (ARC*0.1);
  const dest = -(turns*360 + offset + jitter);
  wheel.style.transition = "transform 5.2s cubic-bezier(.15,.9,.05,1)";
  wheel.style.transform = `rotate(${dest}deg)`;

  const onEnd = ()=>{
    wheel.removeEventListener("transitionend", onEnd);
    rotation = dest;
    history.push(idx); spinsLeft -= 1; refreshOrders();
    spinning = false; document.getElementById("spin").disabled = spinsLeft<=0;
  };
  wheel.addEventListener("transitionend", onEnd);
}

function refreshOrders(){
  const body = document.getElementById("orderBody"); body.innerHTML="";
  const counts = new Map(); history.forEach(i=>counts.set(i,(counts.get(i)||0)+1));
  const t = totalWeight();
  ITEMS.forEach((s,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${s.emoji} ${s.name}</td><td>‚âà ${(t?(s.weight/t*100):0).toFixed(1)}%</td><td style="text-align:right;">${counts.get(i)||0}</td>`;
    body.appendChild(tr);
  });
  document.getElementById("spinsLeft").textContent = spinsLeft;
}

// controls
document.getElementById("apply").addEventListener("click", ()=>{
  const p = Math.max(1, Math.floor(Number(document.getElementById("people").value)||0));
  spinsLeft = p*2; refreshOrders(); showToast(`‰∫∫Êï∞ ${p}‰∫∫ / ÂêàË®à ${spinsLeft}Âõû`);
});
document.getElementById("spin").addEventListener("click", spin);
document.getElementById("undo").addEventListener("click", ()=>{ if(spinning||history.length===0) return; history.pop(); spinsLeft += 1; refreshOrders(); });
document.getElementById("reset").addEventListener("click", ()=>{ if(spinning) return; history=[]; spinsLeft=0; refreshOrders(); });
document.getElementById("exportCSV").addEventListener("click", ()=>{
  const counts = new Map(); history.forEach(i=>counts.set(i,(counts.get(i)||0)+1));
  let csv = "„É°„Éã„É•„Éº,Êï∞Èáè\n"; ITEMS.forEach((s,i)=>{ const q = counts.get(i)||0; if(q>0) csv += `${s.name},${q}\n`; });
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"}); const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href=url; a.download="orders_6slice.csv"; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url), 500);
});
document.addEventListener("keydown", e=>{ if(e.key.toLowerCase()==="f"){ const de=document.documentElement; if(!document.fullscreenElement){ de.requestFullscreen?.(); } else { document.exitFullscreen?.(); } } });

function init(){ buildWeights(); refreshOrders(); }
init();
</script>
</body>
</html>
